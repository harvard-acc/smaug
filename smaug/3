#include "smaug/operators/common.h"
#include "smaug/operators/ref/ref_device_add.h"

#ifdef __cplusplus
extern "C" {
#endif
// By convention, we prefix all pointers into host memory with "host_".
void my_add(float* host_input0, 
		float* host_input1, 
		float* host_output, 
		float* spad0, 
		float* spad1, 
		float* spad2, 
		int size) {
	// Copy input data from host_inputN to spadN. The first argument to dmaLoad
	// or dmaStore is always the destination.
	dmaLoad(spad0, host_input0, size);
	dmaLoad(spad1, host_input1, size);
	for (int i = 0; i < size; i++) {
		// Accumulate the data from spad0 into spad1.
		// NOTE: This could be optimized more if we had three scratchpads instead
		// of two. This would be a great exercise for the reader :)
		//spad1[i] += spad0[i];
		spad2[i] = spad0[i] + spad1[i];
	}
	// Copy output data from spad1 back to the host.
	dmaStore(host_output, spad1, size);
}

#ifdef __cplusplus
}  // extern "C"
#endif
